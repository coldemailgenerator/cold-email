
{% extends 'base.html' %}

{% block title %}Set Lock Password - EmailGen{% endblock %}

{% block extra_css %}
<style>
    .security-hero {
        background: linear-gradient(135deg, var(--primary-color), #0f2a7a);
        color: white;
        padding: 3rem 0;
        border-radius: 0 0 30px 30px;
        margin-bottom: 3rem;
    }

    .security-card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 3rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
        max-width: 500px;
        margin: 0 auto;
    }

    .security-icon {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 2rem;
        text-align: center;
    }

    .form-control {
        border-radius: 10px;
        border: 2px solid var(--border-color);
        padding: 1rem;
        font-size: 1.1rem;
        background: var(--card-bg);
        color: var(--text-color);
        transition: all 0.3s ease;
        margin-bottom: 1rem;
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(16, 52, 166, 0.25);
        background: var(--card-bg);
        color: var(--text-color);
    }

    .security-btn {
        background: linear-gradient(135deg, var(--primary-color), #0f2a7a);
        border: none;
        border-radius: 25px;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 1rem;
    }

    .security-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
    }

    .password-strength {
        margin-top: 0.5rem;
        padding: 0.5rem;
        border-radius: 5px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .strength-weak {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ffcdd2;
    }

    .strength-medium {
        background: #fff3e0;
        color: #ef6c00;
        border: 1px solid #ffe0b2;
    }

    .strength-strong {
        background: #e8f5e8;
        color: #2e7d32;
        border: 1px solid #c8e6c9;
    }

    .security-tips {
        background: var(--bg-color);
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
        border-left: 4px solid var(--primary-color);
    }

    .tip-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .tip-item i {
        color: var(--primary-color);
        margin-right: 0.5rem;
    }

    @media (max-width: 768px) {
        .security-hero {
            padding: 2rem 0;
        }
        
        .security-card {
            padding: 2rem;
            margin: 0 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="security-hero">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-3">
            <i class="fas fa-shield-alt me-3"></i>Set Lock Password
        </h1>
        <p class="lead">Secure your private emails with a custom password</p>
    </div>
</div>

<div class="container">
    <div class="security-card">
        <div class="security-icon">
            <i class="fas fa-lock"></i>
        </div>
        
        <h2 class="text-center mb-4">Create Your Lock Password</h2>
        
        <form method="POST" id="lockPasswordForm">
            <div class="mb-3">
                <label for="password" class="form-label fw-bold">
                    <i class="fas fa-key me-2"></i>New Lock Password
                </label>
                <input type="password" class="form-control" id="password" name="password" 
                       placeholder="Enter a strong password" required>
                <div id="passwordStrength" class="password-strength" style="display: none;"></div>
            </div>
            
            <div class="mb-3">
                <label for="confirmPassword" class="form-label fw-bold">
                    <i class="fas fa-check-circle me-2"></i>Confirm Password
                </label>
                <input type="password" class="form-control" id="confirmPassword" 
                       placeholder="Confirm your password" required>
                <div id="passwordMatch" style="display: none; margin-top: 0.5rem;"></div>
            </div>
            
            <button type="submit" class="security-btn" id="submitBtn">
                <i class="fas fa-shield-alt me-2"></i>Set Lock Password
            </button>
        </form>
        
        <div class="security-tips">
            <h5 class="mb-3">
                <i class="fas fa-lightbulb text-primary me-2"></i>Password Tips
            </h5>
            <div class="tip-item">
                <i class="fas fa-check"></i>
                <span>Use at least 8 characters</span>
            </div>
            <div class="tip-item">
                <i class="fas fa-check"></i>
                <span>Include uppercase and lowercase letters</span>
            </div>
            <div class="tip-item">
                <i class="fas fa-check"></i>
                <span>Add numbers and special characters</span>
            </div>
            <div class="tip-item">
                <i class="fas fa-check"></i>
                <span>Avoid common words or patterns</span>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="/profile" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Profile
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordMatch = document.getElementById('passwordMatch');
    const submitBtn = document.getElementById('submitBtn');

    passwordInput.addEventListener('input', function() {
        const password = this.value;
        checkPasswordStrength(password);
        checkPasswordMatch();
    });

    confirmPasswordInput.addEventListener('input', function() {
        checkPasswordMatch();
    });

    function checkPasswordStrength(password) {
        if (password.length === 0) {
            passwordStrength.style.display = 'none';
            return;
        }

        let strength = 0;
        let feedback = [];

        if (password.length >= 8) strength++;
        else feedback.push('At least 8 characters');

        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        else feedback.push('Upper and lowercase letters');

        if (/\d/.test(password)) strength++;
        else feedback.push('Numbers');

        if (/[^A-Za-z0-9]/.test(password)) strength++;
        else feedback.push('Special characters');

        passwordStrength.style.display = 'block';

        if (strength < 2) {
            passwordStrength.className = 'password-strength strength-weak';
            passwordStrength.innerHTML = '<i class="fas fa-times me-2"></i>Weak password. Missing: ' + feedback.join(', ');
        } else if (strength < 4) {
            passwordStrength.className = 'password-strength strength-medium';
            passwordStrength.innerHTML = '<i class="fas fa-exclamation me-2"></i>Medium password. Consider adding: ' + feedback.join(', ');
        } else {
            passwordStrength.className = 'password-strength strength-strong';
            passwordStrength.innerHTML = '<i class="fas fa-check me-2"></i>Strong password!';
        }
    }

    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (confirmPassword.length === 0) {
            passwordMatch.style.display = 'none';
            return;
        }

        passwordMatch.style.display = 'block';

        if (password === confirmPassword) {
            passwordMatch.innerHTML = '<span style="color: #2e7d32;"><i class="fas fa-check me-2"></i>Passwords match!</span>';
            submitBtn.disabled = false;
        } else {
            passwordMatch.innerHTML = '<span style="color: #c62828;"><i class="fas fa-times me-2"></i>Passwords do not match</span>';
            submitBtn.disabled = true;
        }
    }

    document.getElementById('lockPasswordForm').addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (password !== confirmPassword) {
            e.preventDefault();
            alert('Passwords do not match!');
            return;
        }

        if (password.length < 6) {
            e.preventDefault();
            alert('Password must be at least 6 characters long!');
            return;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Setting Password...';
    });
</script>
{% endblock %}
